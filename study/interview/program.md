# 个人介绍

你好， 我叫马齐翔，17年毕业，18年底开始接触前端开发，已有接近3年的前端开发经验

目前在叮咚买菜前端架构组工作，主要做的项目有`可视化埋点系统`，`监控系统`

> 可视化埋点平台

在我刚到叮咚的时候，也是主要做业务开发，后来在开发过程中发现整个前端的埋点存在很大的问题

1. 埋点略微比较花时间，有时候一个大点的需求，他的埋点就要占用1天左右的人力进行开发
2. 新增埋点上线或者修改埋点存在很大的隐患，例如发现一个埋点错误，手动修改代码之后上线，如果不跟迭代那么要走紧急发版流程在web端至少也要一天的时间，而在native端用的时间只会更久

基于以上原因，我提出了可视化埋点的方案，然后花费了大约2个月多的时间研发了一整套完整的可视化埋点平台

跟市面上的可视化的对比

1. 市面上可视化的方案都无法携带一些业务参数
2. 市面上的可视化方案对小程序的并不是特别友好

在研发到落地的过程中，一共遇到了几个问题

1. 由于我是web开发，所以不太懂native跟数仓侧的内容，所以找老板协调了资源来进行开发
2. 如何验证数据的准确性，我们的方案是不对老埋点进行删除，而是进行了新增的埋点双写，老埋点对照数据来发现问题并修改
3. 如何推动报表落地，由我的老板带领我一起去跟他的老板沟通整个埋点平台的优势以及推动dw做底表的切换，跟自动化报表的生成（已有的自动化报表平台）
4. 如何确定埋点上报无误
    - 测试：
      - 同样通过上报的方式能够提供一个校验的脚本，能够在pc端直接展示当前的埋点是否通过测试
      - app进行自动化脚本测试
    - path问题
        - 上线前：因为业务迭代可能导致path变化， 所以在build的时候做了一个静态编译，找到当前项目中所有的path，然后跟生产平台的path做对比， 如果发现path丢失就进行报警
        - 上线后：对所有的埋点进行的监控，如果发现某条埋点直接降为了0，就会发出报警
        - 上线后：可能会存在埋点没有问题，但是业务字段丢失的情况，这种我们也是采用了上报到监控大盘进行埋点业务字段丢失的判断
    - 落表问题：我们是使用kafka的，而从客户端上报到kafka中间只有一层上报服务，所以我们的方案是针对kafka消费之后数据落表是否报错，如果报错就不操作游标，重新从原先的位置开始读
    - 上报问题：上报接口可能会发生一些接口异常，那么前端就会发起重试，小程序是单条发送，native端是会进行剔除写入报错的埋点，重新上报未写入的埋点
5. 如果推广使用
    - 开发使用，不断召开技术会议，讲解内部技术
    - 产品使用
        1. 埋点事件录入： 由专门的培训过的产品介绍相关的细节，进行培训
        2. 埋点事实录入： 通过PC页面操作与app上操作想结合，pc滑动到path，手机页面凸显当前模块，让产品能知道这个path对应的模块，（业务数据找开发了解）
6. 如何维护整个平台
    - 接入后台系统吐槽功能，在企微里面，吐槽使用问题的直接反馈到企微群，能够及时知道用户的使用情况

> 监控平台：

从上面埋点的监控问题，引发出了一系列相关的监控问题，我发现叮咚目前的监控系统采用的是grafana，他存在一定的问题

1. 无法使用自定义code的能力去对数据进行操作后的上报（grafana主要还是）
2. 无法分时段的监控相关的内容，经常出现低峰期的误报
3. 部分报错之后，在公司内部的测试机无法准确定位报错的位置
4. grafana的监控缺乏对两个数据操作，或者单个数据的日环比周同比的监控

所以决定自研了一个监控的系统，另外带上了异常链路的追踪

整个项目大概投入了我一个人，在一个月左右的时间就完成了监控相关的内容，就由我逐步的从原本的grafana的监控慢慢的迁移对应的监控内容

这个项目异常的顺利， 可能是因为我们这边目前也是刚刚运用grafana，并没有完全深入的使用，所以对于迁移的反感都特别的小

同时也借助了埋点跟部分接口的数据，生成了一个能够知道业务报错 / 埋点报错的用户操作的完整链路，目前只是简单的页面展示，还没有达到用户操作链路视频回放的效果

最终但我们解决了这些问题之后， 现在已经全面上线替换了老埋点，对整个开发的工作量直接减少了80%，对埋点的修复跟新增的埋点收集时间从原本的至少7天降为现在1天就可以看到结果，同时监控平台还能对业务上的js报错，埋点报错提供一个可回溯的能力，使开发查错减少了大约30%的人力