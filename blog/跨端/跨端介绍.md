# 跨端技术

通常意义上讲，在前端领域的跨端指的是一套代码落地到不同的native操作系统上，也就是常说的`write once run anywhere`

## 为什么会出现跨端

当公司发展到一定程度的时候，需要进行更多的业务场景建设，就会发生一个问题，同样的业务，同样的逻辑在不同的平台，不同的系统上，要有多个人去开发实现，这随之带来的人力成本的消耗是巨大的

- 跨PC和移动端
- 跨多native平台：例如安卓，iOS，鸿蒙，甚至于windows
- 跨多个app投放同一个页面：不少偏营销类型的页面会存在说在多款app中同时进行投放
- 跨web与app：这基本上就是平时所说的RN, WEEX等能直接在app与web同步开发的应用
- 跨web，小程序，quickapp等：对于小程序等自闭环的环境，由于各自app厂商不同，为了凸显各自的特点，所以导致各api没有完全对其的情况

基于以上原因，社区开始提倡出一些跨端的技术手段，来实现一套代码在多个平台或者多个端进行运行

## 耳熟能详的跨端技术方案

### 功能强大，跨端能力出色的webview

不管是在各个开放的平台上，还是在一些类似于小程序的封闭生态中都能够被支持的不错，同时他还是符合W3C标准的，这也意味着他对于前端而言能带来不少的优势

1. 开发成本低
2. 不管在什么平台上面，他的标准都始终是统一的
3. 拥有足够繁荣的生态，毕竟他就是前端人员最熟悉的那么一套
4. 能够实现完全的动态化

所以，在于跨端的角度上来说，这基本上满足了所有跨端的条件，也是成为了很多业务方向的不二之选

那为什么不直接全部使用web，抛弃掉`native`生态呢？

答案是在他的体验跟性能上

我们都知道，在移动端设备上使用app的时候都是需要先下载才能使用，这就表明着，当你下载完成之后，你所有的页面以及资源都已经在你的设备上存好了，打开的时候不需要经过网络加载就能够直接使用，而且`webview`中的页面毕竟是`web`页面，就自带了`web`的一系列特性，并且`webview`属于`native`中的一个组件，他的可用能力有限，如果需要使用到`native`本身的能力的话，还需要通过`JSB`来调用，所以从这些方面不可避免的会带来更多的消耗，那么自然他的体验跟性能上就会变得相对于`native`来说差一些

当然，现在的技术发展下去，启动性能上的差异其实基本上是可以被磨平的，只要`native`的开发能够实现一套比较完整的缓存策略，那么还是可以够看的，我个人认为最大的问题可能还是出现在体验上，如果web的体验能跟上native的体验，那么webview的跨端选择的优先级又一步的上升了，考虑一下，是不是可以使用canvas来绘制绝大多数的页面？canvas绘制的话，体验问题应该能够解决，但是性能跟老版本的问题的话，依旧是一个难点

### 类RN / weex框架

在移动互联网早期的时候，在使用webview是一件极其痛苦的事情，毕竟他的一个性能上的问题一直在困扰着，所以那时候就出现了一些类似于`RN`这样的明星产品

这类方案是一个取长补短的方案，将动态化，逻辑能力都扔给JS去执行，而绘制页面的能力依旧是让`native`去执行，这样做的好处是，在结合`JSB`的基础上，让页面UI的体验与`native`保持同步，而逻辑处理全部交给`native`自身的js执行引擎来进行执行并返回出相应的结果

从本质上来讲，以`RN`为例，跟`webview`不同的地方就在于，`webview`是使用`html`的`dom`描述，由浏览器进行相应的渲染，因为是单线程的原因，在渲染的同时会阻断`js`的执行，而`RN`则不同，它的方案是将`html`转换为`js`可以识别的`ast代码`，再由`native`基于`ast代码`进行绘制，由于`native`是可以进行多线程并行的，所以在渲染跟执行的过程中并不会被阻断，这也就变相的解决了一些使用`webview`进行跨端的难题

但是这也相应有不少的缺陷

1. 由于`js`跟`native`不是在同一个线程执行，那么相应的他们的通信会带来不少的损耗
2. `iOS/Android`他们的页面绘制方式不同，代表着要添加不同的组件来适应
3. 依赖于`native`，那么就表示他的`css`转义会变得更加困难，很多`css`也不一定能够完整的实现

当然，最大的问题依旧在于维护上

不依赖于`webview`代表着你的页面是不完全动态化的，至少你的组件是固定的，也就是在相同的页面使用情况下，如果想对组件进行修改，那么还是需要依赖于native提供新的组件能力，这样的话发版依旧会成为一个困扰的问题，而且维护的成本又进一步的上升的

### flutter

可以说`RN`类型的框架他还是拥抱了部分web的生态，却又不是完全的拥抱，但是`flutter`这个框架从出生就是不打算继续借着web来发展

它本身是使用skia绘制到屏幕上的，也就是说，通过自建绘制能力，来保证多端的统一性，这样做的好处在于能够完全的减少双端差异的人力投入，也不需要使用`native`跟`js`进行`bridge`的交互从而得到对应的页面，讲到比较熟悉的一个古老方案就是`QT`

方案的思想跟实现都是比较适合跨端能力的体现，但是问题在于他不依赖于前端生态，那么前端人员入手的时候会带来一定的困扰，所以目前市面上多出了很多基于`flutter`设计的前端实现方案，类似于`kraken`、`liteApp`等等

不可否认的是这种方案的思想是能最根本解决跨端带来的困扰，但是他的动态化能力偏弱，在部分领域依旧不是那么适用

### 小程序跨端框架

小程序之所以被创造出来，是因为各家业务上探索最终产生的结果，但是他的出现就带来了具体的问题，因为各种商业化的原因，各家对于小程序都是拥有各自的考量，不约而同的都是做了一个封闭的生态。

那么小程序既然是一个受控并且封闭的生态，而应用方又需要针对多个小程序产商进行投放，自然而然的就会在框架层面进行思考

#### 编译时方案

最开始出现的就是由编译时进行代码的转换，比较出名的两个框架分别是`taro`， `uniapp`。

一个是react的代表作，一个是vue的代表作，他们的方案一开始都是相同的，通过webpack编译的手段生成不同的平台端的代码，运行的时候借助部分的库对应的原生能力提供相应的支撑，从而获得一个相对比较满意的开发环境以及一套代码跑多端，当然这依旧是存在不少问题

1. 由于是编译期做的事情，那么很自然的就会有`react / vue`与小程序本身存在不兼容的情况，所以会被舍弃掉部分自身携带的能力
2. 由于做了诸多限制，自然会带来一些难受的开发体验
3. 不管是`taro`还是`uniapp`采用这种方案的时候，热更都会存在一个问题，从库代码转换到小程序编译一次，小程序自身再编译一次，就是需要两次编译，带来的开发成本消耗巨大

#### 运行时方案

这种方案是由`remax`优先提出，`taro-next`在发现这个方案之后，为了解决自身针对与jsx的无限制的维护问题，转而同样的采用了这种方案

他的方案跟`RN`有点类似，都是通过`react`生成的`vdom`导入给`native`，让`native`进行渲染，同样的，放弃编译时候的方案自然会加重运行时候的性能，但是从另一个角度「能够使用react的全部特性」去考虑这个问题的话，我是觉得可以进行取舍的，并且因为采用了这样的方案，让react一套代码跑跨app，小程序，web成为了可能「目前我记得是有在实践的公司，但是具体的有点记不太清楚了，有印象的可以跟我沟通下」

所以运行时的方案采用损耗一点性能来提升开发上的体验度，并且完全支持了新版本的能力，以及不用每次版本更替都要完全的进行跟着迭代

#### 小程序小结

以上两种方案都是可以使用的方案，但是就目前而言，小程序的开发体验依旧是十分的差，在业务代码越来越重的时候很难起到一个在开发过程中很舒适的一个环境，主要在于多次编译的问题

笔者曾经也探寻过是否存在可以不多次编译的可能性，以及小程序动态化的可能性

目前来看，瓶颈是存在于小程序的css无法完全动态化的问题，导致实现动态化的方案会比较粗糙，类似于remax的概念可以实现部分的动态化效果，不过这种基本上能够使用在营销页上面，但是用webview不好吗？哈哈哈哈

还有就是基于faas的小程序开发体验，但是他也是相同的问题，只能够实现部分的逻辑动态化，而且对于公司的成本比较高，毕竟faas没这么容易去使用的！

### 结尾

以上是笔者最近一段时间对于跨端方向的一些研究，后续会更加深入的研究一些内容，当然也不只有跨端，也会涉及到更多有趣的知识，欢迎大家关注一下~~谢谢

当然，也非常欢迎想来我部门的小伙伴，目前在`抖音电商 - 商家赋能团队`，杭州和上海都有base哦~， 其他兄弟团队也能推，只要你想来我都能推，哈哈哈哈